<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Admin Pro | Animeverse</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00d2ff; --bg: #020508; --card: #0d1621; }
        body { background: var(--bg); color: #fff; font-family: 'Poppins', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .admin-box { width: 100%; max-width: 650px; background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid var(--neon); box-shadow: 0 0 20px rgba(0, 210, 255, 0.2); box-sizing: border-box; }
        h2 { font-family: 'Orbitron'; color: var(--neon); text-align: center; text-shadow: 0 0 10px var(--neon); margin-bottom: 25px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 13px; color: #aaa; }
        input, textarea, select { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; border-radius: 10px; color: #fff; outline: none; box-sizing: border-box; }
        .hint { font-size: 11px; color: #666; margin-top: 4px; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; color: #000; font-weight: 800; font-family: 'Orbitron'; cursor: pointer; background: var(--neon); margin-top: 15px; }
        .status { margin-top: 15px; font-size: 14px; color: var(--neon); text-align: center; font-weight: bold; }
        .row { display: flex; gap: 10px; }
    </style>
</head>
<body>

    <div class="admin-box">
        <h2>ðŸš€ UNIVERSAL ADMIN</h2>
        
        <div class="form-group">
            <label>1. Anime ID (Slug Name)</label>
            <input type="text" id="animeID" placeholder="e.g. gundam">
            <div class="hint">URL ke liye: player.html?id=gundam</div>
        </div>

        <div class="form-group">
            <label>2. Watch Page Title</label>
            <input type="text" id="watchPageName" placeholder="e.g. Gundam Season 1 (Hindi)">
        </div>

        <div class="row">
            <div class="form-group" style="flex:1;">
                <label>3. Season</label>
                <select id="seasonSelect"></select>
            </div>
            <div class="form-group" style="flex:1;">
                <label>4. Bot Code Name</label>
                <input type="text" id="botPrefix" placeholder="e.g. gundam">
                <div class="hint">Jo aapne Bot/Firebase mein rakha hai.</div>
            </div>
        </div>

        <div class="form-group">
            <label>5. Paste JSON Data or Links</label>
            <textarea id="inputData" style="height:150px;" placeholder='{ name: "Ep 1", url: "...", ep: "1" },'></textarea>
            <div class="hint">Aap apna comma wala JSON yahan direct paste kar sakte hain.</div>
        </div>

        <button id="uploadBtn" class="btn" onclick="processData()">ðŸš€ SYNC TO SHEET</button>
        <div id="status" class="status"></div>
    </div>

    <script>
        const select = document.getElementById('seasonSelect');
        for (let i = 1; i <= 20; i++) {
            select.innerHTML += `<option value="S${i}">Season ${i}</option>`;
        }

        async function processData() {
            const animeID = document.getElementById('animeID').value.trim().toLowerCase();
            const displayName = document.getElementById('watchPageName').value.trim();
            const season = document.getElementById('seasonSelect').value;
            const botPrefix = document.getElementById('botPrefix').value.trim();
            let rawData = document.getElementById('inputData').value.trim();
            
            const btn = document.getElementById('uploadBtn');
            const statusDiv = document.getElementById('status');
            
            // Yahan apna Google Script URL dalein
            const scriptURL = "https://script.google.com/macros/s/AKfycbzEuteJgU1zcQwsNudt5SWG0gMWJOlFmJkshREOk4tvSecJ23mq22u6Dg-Sf3CAxoj-Rw/exec";

            if (!animeID || !displayName || !botPrefix || !rawData) return alert("Sari fields bharna zaroori hai!");

            btn.disabled = true;
            let items = [];

            try {
                if (rawData.includes("{")) {
                    // Auto-Cleaner Logic for your comma format
                    let cleanData = rawData;
                    if (!rawData.startsWith("[")) cleanData = "[" + cleanData;
                    if (!rawData.endsWith("]")) cleanData = cleanData.replace(/,?\s*$/, "") + "]";
                    
                    // JSON parsing with a small trick for loose formats
                    items = eval(cleanData); 
                } else {
                    const lines = rawData.split('\n').filter(l => l.trim() !== "");
                    items = lines.map((url, index) => ({ url: url.trim(), ep: index + 1 }));
                }

                for (let i = 0; i < items.length; i++) {
                    const epNum = items[i].ep || (i + 1);
                    const epNameFormatted = `${season} - ${items[i].name || 'Ep ' + epNum}`;
                    const finalBotCode = `${botPrefix}_${season}_${epNum}`;

                    statusDiv.innerText = `Syncing: ${epNameFormatted}... (${i+1}/${items.length})`;

                    await fetch(scriptURL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({
                            animeID: animeID,
                            displayName: displayName,
                            epName: epNameFormatted,
                            videoURL: items[i].url,
                            botCode: finalBotCode
                        })
                    });
                }

                statusDiv.innerText = "âœ… UPLOAD SUCCESSFUL!";
                document.getElementById('inputData').value = "";
                alert("Sheet Updated!");
            } catch (e) {
                console.error(e);
                alert("Format Error! Check brackets and commas.");
            }
            btn.disabled = false;
        }
    </script>
</body>
</html>
